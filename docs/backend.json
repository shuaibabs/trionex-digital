
{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user account within the system.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user entity."
        },
        "email": {
          "type": "string",
          "description": "User's email address.",
          "format": "email"
        },
        "firstName": {
          "type": "string",
          "description": "The first name of the user."
        },
        "lastName": {
          "type": "string",
          "description": "The last name of the user."
        }
      },
      "required": [
        "id",
        "email",
        "firstName",
        "lastName"
      ]
    },
    "PasswordResetToken": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "PasswordResetToken",
      "type": "object",
      "description": "Represents a password reset token for a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the password reset token."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N PasswordResetToken)"
        },
        "token": {
          "type": "string",
          "description": "The password reset token."
        },
        "expirationDate": {
          "type": "string",
          "description": "The expiration date of the token.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "token",
        "expirationDate"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous",
      "emailLink",
      "google.com"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profile information.  Authorization is path-based; only the authenticated user (or an admin role, if implemented elsewhere) can read/write their own document.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/passwordResetTokens/{passwordResetTokenId}",
        "definition": {
          "entityName": "PasswordResetToken",
          "schema": {
            "$ref": "#/backend/entities/PasswordResetToken"
          },
          "description": "Stores password reset tokens for each user. Authorization is path-based; only the authenticated user (or an admin role, if implemented elsewhere) can manage their own tokens.  This structure allows for secure list operations as password reset tokens are confined to the user's subcollection.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "passwordResetTokenId",
              "description": "The unique identifier of the password reset token."
            }
          ]
        }
      }
    ],
    "reasoning": "This Firestore structure is designed to support user authentication and password reset functionality for the Synergy Digital website. It prioritizes security, scalability, and maintainability by adhering to Authorization Independence and Structural Segregation principles. User data is stored in a dedicated collection, while password reset tokens are stored in user-specific subcollections to ensure proper isolation and security. This design eliminates the need for `get()` calls in security rules, simplifying authorization logic and improving performance.  The structure allows for secure `list` operations on password reset tokens as they are confined to the user's subcollection and only accessible to the user themselves. By storing roles in the database (DBAC), authorization relies solely on `request.auth.uid`, enhancing security and simplifying management."
  }
}
